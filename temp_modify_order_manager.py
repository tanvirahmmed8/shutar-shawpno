from pathlib import Path
path = Path('app/Utils/order-manager.php')
text = path.read_text()
start = text.index('    public static function generate_order()')
end = text.index('    public static function updated_generate_order', start)
method = text[start:end]
replace_token = "         = ["
precheck = "         = app(LotInventoryService::class);\n         = CartManager::getCartListQuery(groupId: ['cart_group_id'], type: 'checked');\n\n        foreach ( as ) {\n            if ((['product_type'] ?? 'physical') === 'physical') {\n                ->assertSufficientStock(['product_id'], ['quantity']);\n            }\n        }\n\n         = ["
method = method.replace(replace_token, precheck, 1)
block_start = method.index("        if (['payment_method'] == 'offline_payment')")
block_end = method.index("         = Order::with('customer', 'seller.shop', 'details')->find();")
transaction_block = "        DB::transaction(function () use (, , , , , , ) {\n            if (['payment_method'] == 'offline_payment') {\n                OfflinePayments::insert([\n                    'order_id' => ,\n                    'payment_info' => json_encode(['offline_payment_info']),\n                    'created_at' => Carbon::now(),\n                ]);\n            }\n\n            DB::table('orders')->insertGetId();\n            self::add_order_status_history(, , ['payment_status'] == 'paid' ? 'confirmed' : 'pending', 'customer');\n\n            foreach ( as ) {\n                 = Product::where(['id' => ['product_id']])->with(['digitalVariation', 'clearanceSale' => function () {\n                    return ->active();\n                }])->first()->toArray();\n                unset(['is_shop_temporary_close']);\n                unset(['thumbnail_full_url']);\n                unset(['color_images_full_url']);\n                unset(['meta_image_full_url']);\n                unset(['images_full_url']);\n                unset(['reviews']);\n                unset(['translations']);\n\n                 = DigitalProductVariation::with(['storage'])->where(['product_id' => ['product_id'], 'variant_key' => ['variant']])->first();\n                if (['digital_product_type'] == 'ready_product' and ) {\n                     = Storage::where([\n                        'data_id' => ['id'],\n                        \"data_type\" => \"App\\Models\\DigitalProductVariation\",\n                    ])->first();\n\n                    ['digital_file_ready'] = ['file'];\n                    ['storage_path'] = .value if  else 'public';\n                elif ['digital_product_type'] == 'ready_product' and ['digital_file_ready']:\n                    ['storage_path'] = ['digital_file_ready_storage_type'] if ['digital_file_ready_storage_type'] else 'public';\n\n                 = ['tax_model'] == 'include' and ['price'] - ['tax'] or ['price'];\n                 = getProductPriceByType(product: , type: 'discounted_amount', result: 'value', price: ['price']);\n                 = [\n                    'order_id' => ,\n                    'product_id' => ['product_id'],\n                    'seller_id' => ['seller_id'],\n                    'product_details' => json_encode(),\n                    'qty' => ['quantity'],\n                    'price' => ,\n                    'tax' => ['tax'] * ['quantity'],\n                    'tax_model' => ['tax_model'],\n                    'discount' =>  * ['quantity'],\n                    'discount_type' => 'discount_on_product',\n                    'variant' => ['variant'],\n                    'variation' => ['variations'],\n                    'delivery_status' => 'pending',\n                    'shipping_method_id' => None,\n                    'payment_status' => 'unpaid',\n                    'created_at' => 'now()',\n                    'updated_at' => 'now()'\n                ]\n\n                if (['variant'] != None):\n                    pass\n            }\n        });\n\n         = Order::with('customer', 'seller.shop', 'details')->find();\n"
raise SystemExit('Script not implemented fully')
